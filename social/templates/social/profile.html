{% extends 'landing/base.html' %}

{% load crispy_forms_tags %}

<title>
    {% block title %}Profile Details{% endblock %} | MateMeet
</title>

{% block content %}
    <div class="container">
        <div class="row  my-5">
            <div class="col-md-3 col-sm-6">
                <a href="{% url 'post-list' %}" class="btn btn-light">Back to Feed</a>
            </div>
        </div>
        <div class="row justify-content-center my-4">
            <div class="card shadow-lg col-md-8 col-sm-12 border-bottom px-5 pt-3">
                <div class="text-center">
                    <img src="{{ profile.picture.url }}" class="rounded-circle mx-3 mt-3" width="100" height="100">
                    <h3 class="py-4">{{ profile.name }}
                        <span>
                            {% if request.user == user %}
                                <a href="{% url 'edit-profile' profile.pk %}" class="edit-name""><ion-icon name="create-outline"></ion-icon></a>
                            {% endif %}
                        </span>
                    </h3>
                </div>
                <hr class="mx-auto"; width="40%" color="blue" />
                <div class="d-flex flex-row mx-auto">
                    {% if profile.location %}
                        <p>&nbsp;<ion-icon class="px-2 icon__color" name="location-outline"></ion-icon>{{ profile.location }}</p>
                    {% endif %}

                    {% if profile.birth_date %}
                        <p class="ms-4">&nbsp;<ion-icon class="px-2 icon__color" name="calendar-outline"></ion-icon>{{ profile.birth_date }}</p>
                    {% endif %}
                </div>

                {% if profile.bio %}
                    <p>{{ profile.bio }}</p>
                {% endif %}
                <div class="row justify-content-center m-auto">
                    <div class="col-md-12 col-sm-12 px-5 pt-3 mb-4">
                        <div class="d-flex flex-row mb-3">
                            {% if user == request.user %}
                            {% else %}
                            {% if is_following %}
                                <form method="POST" action="{% url 'remove-follower' profile.pk %}">
                                    {% csrf_token %}
                                    <button class="btn btn-outline-danger" type="submit"><ion-icon name="person-remove-outline"></ion-icon></button>
                                </form>
                            {% else %}
                                <form method="POST" action="{% url 'add-follower' profile.pk %}">
                                    {% csrf_token %}
                                    <button class="btn btn-outline-success" type="submit"><ion-icon name="person-add-outline"></ion-icon></button>
                                </form>
                            {% endif %}
                            {% endif %}
                            <a href="{% url 'list-followers' profile.pk %}" class="profile__dn mx-auto my-2">
                                <span class="p-2">Followers: {{ number_of_followers }}</span>
                            </a>
                        </div>
                    </div>
                </div>  
            </div>
        </div>
        <!-- <div class="row justify-content-center my-3">
            <div class="card shadow-sm col-md-8 col-sm-12 border-bottom px-5 pt-3">
                
            </div>
        </div> -->
        <!-- <div class="row justify-content-center my-5">
            <div class="col-md-8 col-sm-12 border-bottom">
            <h5>Your Feeds</h5>
            </div>
        </div> -->
        {% for post in posts %}
            <div class="row justify-content-center">
                <div class="col-md-8 col-sm-12 border-bottom mt-2 py-3">
                    <div>
                        <a href="{% url 'profile' post.author.profile.pk %}">
                            <img class="rounded-circle post-img" height="30" width="30" src="{{ post.author.profile.picture.url }}" alt="">
                        </a>
                        <p class="post-text">
                            <a class="profile__dn" href="{% url 'profile' post.author.profile.pk %}">{{ post.author.profile.name }}</a> {{ post.created_on }}
                        </p>
                    </div>
                    <div class="position-relative">
                        <p>{{ post.body }}</p>
                        <a href="{% url 'post-detail' post.pk %}" class="stretched-link"></a>
                    </div>

                    <div class="d-flex flex-row">
                        <form method="POST" action="{% url 'like' post.pk %}">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ request.path }}">
                            <button class="btn-hidden" type="submit">
                                <ion-icon name="thumbs-up-outline"></ion-icon>
                                <span>{{ post.likes.all.count }}</span>
                            </button>
                        </form>

                        <form method="POST" action="{% url 'dislike' post.pk %}">
                            {% csrf_token %}
                            <input type="hidden" name="next" value="{{ request.path }}">
                            <button class="btn-hidden" type="submit">
                                <ion-icon name="thumbs-down-outline"></ion-icon>
                                <span>{{ post.dislikes.all.count }}</span>
                            </button>
                        </form>
                    </div> 
                </div>                
            </div>
        {% endfor %}
    </div>

{% endblock content %}